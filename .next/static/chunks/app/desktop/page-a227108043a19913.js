(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[309],{29837:function(e,t,a){Promise.resolve().then(a.bind(a,40754))},3903:function(e,t,a){"use strict";a.d(t,{V:function(){return c},default:function(){return i}});var o=a(57437),r=a(2265),n=a(16463),l=a(39776);a(76735),a(67059),a(3602),l.Z.apps.length||l.Z.initializeApp({apiKey:"AIzaSyD-X5xUcfYr66Ex15yEHtaTdsbpKjqUSq4",authDomain:"advice-class.firebaseapp.com",projectId:"advice-class",storageBucket:"advice-class.appspot.com",messagingSenderId:"1090594139995",appId:"1:1090594139995:web:bb6bdc4ddea0eca557f47e",measurementId:"G-7PR3RWRWTD"});var s=l.Z;let c=(0,r.createContext)({});var i=function(e){let{children:t}=e,a=(0,n.useRouter)(),[l,i]=(0,r.useState)(null),[d,u]=(0,r.useState)(!1),[g,m]=(0,r.useState)(!0);async function h(e,t){u(!0);try{let{uid:o,email:r}=(await s.auth().signInWithEmailAndPassword(e,t)).user,n={uid:o,email:r};i(n),p(n),u(!1),a.push("/desktop")}catch(e){console.log(e),u(!1)}}async function p(e){localStorage.setItem("SistemaUser",JSON.stringify(e))}async function f(){await s.auth().signOut(),localStorage.removeItem("SistemaUser"),i(null),a.push("/")}return(0,r.useEffect)(()=>{!function(){let e=localStorage.getItem("SistemaUser");e&&i(JSON.parse(e)),m(!1)}()},[]),(0,o.jsx)(c.Provider,{value:{signed:!!l,user:l,loading:g,signIn:h,signOut:f,loadingAuth:d},children:t})}},40754:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var o=a(57437),r=a(2265),n=a(3903),l=a(97501);a(27824);let s=function(){let e=new Date;return{anoAtual:e.getFullYear(),dataTextoFormatada:e.toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}}(),c=()=>{let e=new Date,t=e.toLocaleDateString().replace(/\//g,"-"),a=e.toLocaleTimeString().replace(/:/g,"-");return"Ata_conselho_".concat(t,"_").concat(a,".pdf")},i=e=>new Promise((t,a)=>{let o=new Image;o.src=e,o.crossOrigin="Anonymous",o.onload=()=>{let e=document.createElement("canvas");e.width=o.width,e.height=o.height,e.getContext("2d").drawImage(o,0,0),t(e.toDataURL("image/png"))},o.onerror=e=>a(e)});var d=e=>{let{updatedButtonValues:t,coordenadores:a,diretores:n,turma:d,cabecalho:u,tipoEnsino:g}=e,[m,h]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async()=>{try{let e=await i("/uploadImg/brasao.png");h(e)}catch(e){console.error("Erro ao carregar a imagem:",e)}})()},[]),(0,o.jsx)("div",{className:"text-center mt-4",children:(0,o.jsx)("button",{onClick:()=>{let e="",o="",r="",i="";g&&(i=g.nome_tipo_ensino),u.forEach(t=>{e=t.nome,o=t.bimestre,r=t.cidade});let h=new l.jsPDF({orientation:"landscape",unit:"pt",format:"a4"});h.setFont("Arial","bold",20),m?h.addImage(m,"PNG",50,40,50,50):console.error("Imagem n\xe3o carregada corretamente"),h.text("".concat(e),h.internal.pageSize.getWidth()/2,40,{align:"center"}),h.text("".concat(r),h.internal.pageSize.getWidth()/2,70,{align:"center"}),h.text("ATA DO CONSELHO DE CLASSE E S\xc9RIE",h.internal.pageSize.getWidth()/2,100,{align:"center"}),h.text("".concat(o,"\xba BIMESTRE DE ").concat(s.anoAtual," - ").concat(d," - ").concat(i),h.internal.pageSize.getWidth()/2,140,{align:"center"}),h.setFontSize(12),h.text("Na data de, ".concat(s.dataTextoFormatada,", reuniram-se os Professores e o Coordenador Pedag\xf3gico"),h.internal.pageSize.getWidth()/2,180,{align:"center"}),h.text("para a realiza\xe7\xe3o do Conselho de Classe e S\xe9rie, na forma presencial, com a presen\xe7a registrada abaixo.",h.internal.pageSize.getWidth()/2,200,{align:"center"}),h.text("Legendas: NF:  Nota e Falta | N:  Nota abaixo da m\xe9dia | F: Frequ\xeancia abaixo de 75%",h.internal.pageSize.getWidth()/2,235,{align:"center"});let p=new Set,f=Object.keys(t);for(let e of f)for(let a in t[e])p.add(a);let b=["Nome"].concat([...p].sort()),x=[];for(let e of f){let a=[e];for(let o of b.slice(1))a.push(t[e][o]||"");x.push(a)}h.autoTable({theme:"grid",startY:250,head:[b],body:x,styles:{fontSize:9,textColor:"#333",cellPadding:5,lineColor:"#000",valign:"middle"},headStyles:{fillColor:[255,255,255],textColor:"#000",fontStyle:"bold",halign:"center"},columnStyles:{0:{fontStyle:"bold",cellWidth:"auto",fillColor:[220,220,220]}}}),h.addPage(),h.text("Assinaturas dos professores, coordena\xe7\xe3o e dire\xe7\xe3o respons\xe1veis pela turma: ".concat(d," - ").concat(i),h.internal.pageSize.getWidth()/2,40,{align:"center"}),h.setFontSize(10),h.text("PROFESSORES(AS)",100,80),h.text("ASSINATURA",300,80);for(let e=0;e<30;e++){let t=100+15*e;h.line(100,t,270,t),h.line(300,t,390,t)}h.text("COORDENA\xc7\xc3O: ".concat(a),500,80),h.text("______________________",550,100),h.text("DIRE\xc7\xc3O: ".concat(n),500,150),h.text("______________________",550,170),h.text("".concat(o,"\xba BIMESTRE DE ").concat(s.anoAtual," - ").concat(d," - ").concat(i),h.internal.pageSize.getWidth()/2,570,{align:"center"}),h.save(c())},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Gerar PDF"})})};async function u(e,t,a,o){try{if(e&&t){let t="/api/nomeAluno?turma=".concat(encodeURIComponent(e)),o=await fetch(t);if(!o.ok)throw Error("Erro ao buscar os dados da API de alunos. Status: ".concat(o.status));let r=await o.json();a(r),console.log("Alunos: ",r)}}catch(e){console.error(e)}try{if(e&&t){let e="/api/disciplina?id=".concat(encodeURIComponent(t)),a=await fetch(e);if(!a.ok)throw Error("Erro ao buscar os dados da API de disciplinas. Status: ".concat(a.status));let r=await a.json();o(r),console.log("nomesDisciplina: ",r)}}catch(e){console.error(e)}}function g(){let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(null),[l,s]=(0,r.useState)(null),[c,i]=(0,r.useState)([]),[g,m]=(0,r.useState)({}),[h,p]=(0,r.useState)([]),[f,b]=(0,r.useState)({}),[x,S]=(0,r.useState)([]),[w,v]=(0,r.useState)([]),[_,y]=(0,r.useState)(""),[N,j]=(0,r.useState)(""),[E,C]=(0,r.useState)([]),[A,k]=(0,r.useState)([]),I=(0,r.useRef)(null);(0,r.useEffect)(()=>{(async function(){try{let e=await fetch("/api/pessoas");if(!e.ok)throw Error("Erro ao buscar as pessoas. Status: ".concat(e.status));let t=await e.json();S(t.coordenadores),v(t.diretores)}catch(e){console.error(e)}})()},[]),(0,r.useEffect)(()=>{(async function(){try{let e=await fetch("/api/cabecalho?nomeTurma=".concat(a));if(!e.ok)throw Error("Erro ao buscar o cabe\xe7alho. Status: ".concat(e.status));let t=await e.json();C(t.cabecalho),k(t.tipoEnsino)}catch(e){console.error(e)}})()},[a]),(0,r.useEffect)(()=>{(async function(){try{let e=await fetch("/api/turmaSelect");if(!e.ok)throw Error("Erro ao buscar as turmas. Status: ".concat(e.status));let t=await e.json();p(t)}catch(e){console.error(e)}})()},[]),(0,r.useEffect)(()=>{a&&l&&u(a,l,t,i)},[a,l]),(0,r.useEffect)(()=>{function t(t){let a=t.key,o=/^[0-3]$/.test(a),r=/^[hHjJkKLl]$/.test(a);if(/^Arrow(Up|Down|Left|Right)$/.test(a)&&I.current){var n,l;let e;t.preventDefault();let o=t.target.closest("td"),r=(null==o?void 0:o.parentElement.rowIndex)-1,s=(null==o?void 0:o.cellIndex)-1;switch(a){case"ArrowUp":e=null===(n=I.current.rows[r])||void 0===n?void 0:n.cells[s+1];break;case"ArrowDown":e=null===(l=I.current.rows[r+2])||void 0===l?void 0:l.cells[s+1];break;case"ArrowLeft":e=null==o?void 0:o.previousSibling;break;case"ArrowRight":e=null==o?void 0:o.nextSibling}if(e){let t=e.querySelector("button");t&&t.focus()}}if(o||r){t.preventDefault();let n=I.current.querySelectorAll("button"),l=Array.from(n).findIndex(e=>e===document.activeElement);-1===l&&(l=0);let s=n[l],i=t.target.closest("td"),d=(null==i?void 0:i.parentElement.rowIndex)-1,u=(null==i?void 0:i.cellIndex)-1,g=e[d],m=c[u],h={F:"bg-green-500",N:"bg-blue-500",NF:"bg-red-500","":""},p=o?"0"===a?"Selecionar":"1"===a?"F":"2"===a?"N":"3"===a?"NF":"":r?"h"===a.toLowerCase()?"F":"j"===a.toLowerCase()?"N":"k"===a.toLowerCase()?"NF":"l"===a.toLowerCase()?"Selecionar":"":"";s.innerText=p,s.classList.remove("bg-green-500","bg-blue-500","bg-red-500"),h[p]&&s.classList.add(h[p]),"".concat(g,"_").concat(m);let x={...f,[g]:{...f[g],[m]:p}};b(x),b(x),console.log("updatedValues: ",x)}}return I.current&&I.current.addEventListener("keydown",t),()=>{I.current&&I.current.removeEventListener("keydown",t)}},[e,c,f]);let D=(e,t)=>{let a=e+"_"+t,o=(g[a]||0)+1,r={...g,[a]:o%4};console.log("newNumCliquesCelula: ",r),m(r),b({...f,[e]:{...f[e],[t]:1===o?"F":2===o?"N":3===o?"NF":"Selecionar"}})};return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"flex gap-4",children:[(0,o.jsxs)("div",{className:"w-1/3 mb-4 bg-white rounded-lg shadow-md",children:[(0,o.jsx)("span",{className:"block mb-2 px-2 py-1 bg-blue-500 text-white rounded-t-lg",children:"Selecione o coordenador:"}),(0,o.jsxs)("select",{className:"p-2 w-full border border-blue-500 rounded-b-lg",value:_,onChange:e=>{y(e.target.value)},children:[(0,o.jsx)("option",{value:"",children:"Selecione um Coordenador"}),x.map(e=>{let{id:t,nome:a}=e;return(0,o.jsx)("option",{value:a,children:a},t)})]})]}),(0,o.jsxs)("div",{className:"w-1/3 mb-4 bg-white rounded-lg shadow-md",children:[(0,o.jsx)("span",{className:"block mb-2 px-2 py-1 bg-blue-500 text-white rounded-t-lg",children:"Selecione o diretor:"}),(0,o.jsxs)("select",{className:"p-2 w-full border border-blue-500 rounded-b-lg",value:N,onChange:e=>{j(e.target.value)},children:[(0,o.jsx)("option",{value:"",children:"Selecione um Diretor"}),w.map(e=>{let{id:t,nome:a}=e;return(0,o.jsx)("option",{value:a,children:a},t)})]})]}),(0,o.jsxs)("div",{className:"w-1/3 mb-4 bg-white rounded-lg shadow-md",children:[(0,o.jsx)("span",{className:"block mb-2 px-2 py-1 bg-blue-500 text-white rounded-t-lg",children:"Selecione uma turma:"}),(0,o.jsxs)("select",{className:"p-2 w-full border border-blue-500 rounded-b-lg",value:a,onChange:e=>{let t=e.target.value,a=h.find(e=>e.nome_turma===t);a?(n(a.nome_turma),s(a.id)):(n(null),s(null))},children:[(0,o.jsx)("option",{value:"",children:"Selecione uma turma:"}),h.map(e=>{let{nome_turma:t}=e;return(0,o.jsx)("option",{value:t,children:t},t)})]})]})]}),(0,o.jsx)("div",{className:"overflow-x-auto",children:(0,o.jsxs)("div",{className:"max-h-540 overflow-y-auto overflow-x-auto mx-4",children:[(0,o.jsxs)("table",{ref:I,className:"table-auto border-collapse border border-gray-500 w-full px-4 text-xs",children:[(0,o.jsx)("thead",{className:"bg-gray-500 sticky -top-px z-10",children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{className:"border px-2 py-2 bg-gray-300 sticky top-0 z-10",children:"Nome Aluno"}),c.map((e,t)=>(0,o.jsx)("th",{className:"border px-1 py-2 text-xs bg-gray-300 sticky top-0 z-10",children:e},t))]})}),(0,o.jsx)("tbody",{children:e.map((e,t)=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{className:"px-2 py-2 border border-gray-500  bg-gray-200 style={{ fontSize: '8px' }} overflow-x-auto ",children:(0,o.jsx)("span",{children:e})}),c.map((t,a)=>{let r=g[e+"_"+t]||0;return(0,o.jsx)("td",{className:"border px-1 py-2",children:(0,o.jsx)("button",{className:"p-1 ".concat(1===r?"bg-green-500":2===r?"bg-blue-500":3===r?"bg-red-500":""," w-full rounded"),onClick:()=>{D(e,t)},children:1===r?"F":2===r?"N":3===r?"NF":"Selecionar"})},a)})]},t))})]}),console.log("Data: ",f)]})}),(0,o.jsx)(d,{updatedButtonValues:f,coordenadores:_,diretores:N,turma:a,cabecalho:E,tipoEnsino:A})]})}var m=a(16463);function h(){let{signed:e,loading:t}=(0,r.useContext)(n.V),a=(0,m.useRouter)();return t?(0,o.jsx)("div",{children:"Carregando..."}):e?(0,o.jsx)("div",{className:"container mx-auto p-8",children:(0,o.jsx)(g,{})}):a.push("/")}}},function(e){e.O(0,[358,54,505,502,232,971,23,744],function(){return e(e.s=29837)}),_N_E=e.O()}]);